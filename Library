--// Kaze UI Base (Extended)
--// Window System (PC + Mobile)
--// Added: Strict Texture ID Sanitizer + 60x60 Minimize ImageButton (draggable, ZIndex 999)
--// Extended: Tab system + Elements (Button, Toggle, Dropdown, Slider, Textbox) with neon glow

local KazeUI = {}
KazeUI.__index = KazeUI

--// Services
local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local UIS = game:GetService("UserInputService")
local LP = Players.LocalPlayer

--// Create ScreenGui
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "KazeUI"
ScreenGui.ResetOnSpawn = false
ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
ScreenGui.Parent = LP:WaitForChild("PlayerGui")

--// UIScale for consistent scaling across devices
local UIScale = Instance.new("UIScale")
UIScale.Parent = ScreenGui

local function UpdateScale()
	local size = workspace.CurrentCamera.ViewportSize
	if size.X < 600 then
		UIScale.Scale = math.clamp(size.X / 800, 0.5, 1)
	else
		UIScale.Scale = math.clamp(size.X / 1920, 0.6, 1)
	end
end
UpdateScale()
workspace.CurrentCamera:GetPropertyChangedSignal("ViewportSize"):Connect(UpdateScale)

--// Texture ID Sanitizer
-- Accepts strings like "rbxassetid://123", "Rbxtextureid://123", "123", etc.
-- Extracts digits with string.gsub(id, "%D", "") and returns "rbxassetid://<digits>" or "" if none found.
local function FormatImage(id)
	if not id then return "" end
	id = tostring(id)
	local clean = string.gsub(id, "%D", "") -- keep only digits
	if clean == "" then return "" end
	return "rbxassetid://" .. clean
end

--// Drag Function (works with Mouse and Touch)
local function MakeDraggable(dragPart, targetPart)
	local dragging = false
	local dragInput, dragStart, startPos

	local function update(input)
		if not dragStart or not startPos then return end
		local delta = input.Position - dragStart
		targetPart.Position = UDim2.new(
			startPos.X.Scale, startPos.X.Offset + delta.X,
			startPos.Y.Scale, startPos.Y.Offset + delta.Y
		)
	end

	dragPart.InputBegan:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
			dragging = true
			dragStart = input.Position
			startPos = targetPart.Position
			input.Changed:Connect(function()
				if input.UserInputState == Enum.UserInputState.End then
					dragging = false
					dragInput = nil
				end
			end)
		end
	end)

	dragPart.InputChanged:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
			dragInput = input
		end
	end)

	UIS.InputChanged:Connect(function(input)
		if input == dragInput and dragging then
			update(input)
		end
	end)
end

--// Neon stroke helper
local function ApplyNeonStroke(inst, thickness)
	thickness = thickness or 2
	local stroke = Instance.new("UIStroke")
	stroke.Color = Color3.fromRGB(0, 160, 255)
	stroke.Thickness = thickness
	stroke.Parent = inst
	-- animate between two blue-cyan colors
	spawn(function()
		while inst and inst.Parent do
			local ok, _ = pcall(function()
				local t = TweenService:Create(stroke, TweenInfo.new(1.5, Enum.EasingStyle.Sine, Enum.EasingDirection.InOut, -1, true), {Color = Color3.fromRGB(0, 255, 255)})
				t:Play()
			end)
			break
		end
	end)
	return stroke
end

--// CREATE WINDOW
function KazeUI:CreateWindow(config)
	config = config or {}

	-- Main Config
	local Title = config.Title or "Kaze UI"
	local Author = config.Author or "Unknown"
	local Version = config.Version or "1.0"
	local MainIcon = FormatImage(config.Icon or "6031763447")

	-- Open Button Config (ENFORCED to 60x60 for mobile playability)
	local OpenIcon = FormatImage((config.OpenButton and config.OpenButton.Icon) or config.Icon or "6031763447")
	-- Enforce exact 60x60 size (UDim2.fromOffset) as requested
	local MiniButtonSize = UDim2.fromOffset(60, 60)

	local Callback = config.Callback

	--// Main Window
	local Window = Instance.new("Frame")
	Window.Name = "MainWindow"
	Window.Size = UDim2.fromOffset(650, 420)
	Window.Position = UDim2.fromScale(0.5, 0.5)
	Window.AnchorPoint = Vector2.new(0.5, 0.5)
	Window.BackgroundColor3 = Color3.fromRGB(20, 20, 25)
	Window.BorderSizePixel = 0
	Window.Parent = ScreenGui
	Window.ClipsDescendants = true
	Instance.new("UICorner", Window).CornerRadius = UDim.new(0, 14)

	local WindowStroke = Instance.new("UIStroke")
	WindowStroke.Color = Color3.fromRGB(0, 160, 255)
	WindowStroke.Thickness = 2.5 -- neon thickness
	WindowStroke.Parent = Window

	spawn(function()
		while Window.Parent do
			local t = TweenService:Create(WindowStroke, TweenInfo.new(1.5, Enum.EasingStyle.Sine, Enum.EasingDirection.InOut, -1, true), {Color = Color3.fromRGB(0, 255, 255)})
			t:Play()
			break
		end
	end)

	--// Top Bar
	local TopBar = Instance.new("Frame")
	TopBar.Name = "TopBar"
	TopBar.Size = UDim2.new(1, 0, 0, 56)
	TopBar.BackgroundColor3 = Color3.fromRGB(15, 15, 20)
	TopBar.BorderSizePixel = 0
	TopBar.Parent = Window
	Instance.new("UICorner", TopBar).CornerRadius = UDim.new(0, 14)
	MakeDraggable(TopBar, Window)

	local Icon = Instance.new("ImageLabel")
	Icon.Size = UDim2.fromOffset(32, 32)
	Icon.Position = UDim2.fromOffset(14, 12)
	Icon.BackgroundTransparency = 1
	Icon.Image = MainIcon
	Icon.Parent = TopBar
	Instance.new("UICorner", Icon).CornerRadius = UDim.new(1, 0)

	local TitleLabel = Instance.new("TextLabel")
	TitleLabel.Size = UDim2.new(1, -160, 0, 22)
	TitleLabel.Position = UDim2.fromOffset(56, 8)
	TitleLabel.BackgroundTransparency = 1
	TitleLabel.Text = Title
	TitleLabel.TextColor3 = Color3.fromRGB(235, 235, 235)
	TitleLabel.Font = Enum.Font.GothamBold
	TitleLabel.TextSize = 16
	TitleLabel.TextXAlignment = Enum.TextXAlignment.Left
	TitleLabel.Parent = TopBar

	local SubLabel = Instance.new("TextLabel")
	SubLabel.Size = UDim2.new(1, -160, 0, 18)
	SubLabel.Position = UDim2.fromOffset(56, 30)
	SubLabel.BackgroundTransparency = 1
	SubLabel.Text = Author .. " | v" .. Version
	SubLabel.TextColor3 = Color3.fromRGB(160, 160, 160)
	SubLabel.Font = Enum.Font.Gotham
	SubLabel.TextSize = 13
	SubLabel.TextXAlignment = Enum.TextXAlignment.Left
	SubLabel.Parent = TopBar

	local Minimize = Instance.new("TextButton")
	Minimize.Size = UDim2.fromOffset(36, 36)
	Minimize.Position = UDim2.new(1, -88, 0.5, -18)
	Minimize.Text = "—"
	Minimize.Font = Enum.Font.GothamBold
	Minimize.TextSize = 20
	Minimize.TextColor3 = Color3.fromRGB(220, 220, 220)
	Minimize.BackgroundColor3 = Color3.fromRGB(25, 25, 30)
	Minimize.Parent = TopBar
	Instance.new("UICorner", Minimize).CornerRadius = UDim.new(1, 0)

	local Close = Instance.new("TextButton")
	Close.Size = UDim2.fromOffset(36, 36)
	Close.Position = UDim2.new(1, -44, 0.5, -18)
	Close.Text = "✕"
	Close.Font = Enum.Font.GothamBold
	Close.TextSize = 18
	Close.TextColor3 = Color3.fromRGB(255, 90, 90)
	Close.BackgroundColor3 = Color3.fromRGB(25, 25, 30)
	Close.Parent = TopBar
	Instance.new("UICorner", Close).CornerRadius = UDim.new(1, 0)

	local Content = Instance.new("Frame")
	Content.Position = UDim2.fromOffset(0, 56)
	Content.Size = UDim2.new(1, 0, 1, -56)
	Content.BackgroundTransparency = 1
	Content.Parent = Window

	--// TAB SYSTEM (left tab list + pages)
	local TabsFrame = Instance.new("Frame")
	TabsFrame.Name = "TabsFrame"
	TabsFrame.Size = UDim2.new(0, 140, 1, 0)
	TabsFrame.Position = UDim2.new(0, 0, 0, 0)
	TabsFrame.BackgroundTransparency = 1
	TabsFrame.Parent = Content

	local tabsList = Instance.new("Frame")
	tabsList.Size = UDim2.new(1, 0, 1, 0)
	tabsList.BackgroundColor3 = Color3.fromRGB(18, 18, 22)
	tabsList.BorderSizePixel = 0
	tabsList.Parent = TabsFrame
	Instance.new("UICorner", tabsList).CornerRadius = UDim.new(0, 12)
	local tabsStroke = ApplyNeonStroke(tabsList, 2)

	local TabsLayout = Instance.new("UIListLayout")
	TabsLayout.Padding = UDim.new(0, 8)
	TabsLayout.HorizontalAlignment = Enum.HorizontalAlignment.Center
	TabsLayout.SortOrder = Enum.SortOrder.LayoutOrder
	TabsLayout.Parent = tabsList
	TabsLayout.Padding = UDim.new(0, 10)

	local Pages = Instance.new("Frame")
	Pages.Name = "Pages"
	Pages.Size = UDim2.new(1, -140, 1, 0)
	Pages.Position = UDim2.new(0, 140, 0, 0)
	Pages.BackgroundTransparency = 1
	Pages.Parent = Content

	-- keep track of pages
	local pageTable = {}
	local currentPage = nil

	-- helper to hide all pages
	local function hideAllPages()
		for _, p in pairs(pageTable) do
			if p.Page then p.Page.Visible = false end
			if p.Button then p.Button.Active = true end
		end
	end

	-- Create a new tab/page
	local function CreateTab(name, icon)
		icon = FormatImage(icon or "")
		local tabIndex = #pageTable + 1

		-- Tab button in tabsList
		local TabBtn = Instance.new("TextButton")
		TabBtn.Name = "TabBtn_" .. name
		TabBtn.Size = UDim2.new(1, -16, 0, 44)
		TabBtn.BackgroundColor3 = Color3.fromRGB(25, 25, 30)
		TabBtn.BorderSizePixel = 0
		TabBtn.Text = ""
		TabBtn.LayoutOrder = tabIndex
		TabBtn.Parent = tabsList
		Instance.new("UICorner", TabBtn).CornerRadius = UDim.new(0, 10)
		ApplyNeonStroke(TabBtn, 2)

		local btnIcon = Instance.new("ImageLabel")
		btnIcon.Size = UDim2.fromOffset(28, 28)
		btnIcon.Position = UDim2.fromOffset(8, 8)
		btnIcon.BackgroundTransparency = 1
		btnIcon.Image = icon
		btnIcon.Parent = TabBtn
		Instance.new("UICorner", btnIcon).CornerRadius = UDim.new(1, 0)

		local btnLabel = Instance.new("TextLabel")
		btnLabel.Size = UDim2.new(1, -44, 1, 0)
		btnLabel.Position = UDim2.fromOffset(44, 0)
		btnLabel.BackgroundTransparency = 1
		btnLabel.Text = name
		btnLabel.TextColor3 = Color3.fromRGB(220, 220, 220)
		btnLabel.Font = Enum.Font.GothamBold
		btnLabel.TextSize = 14
		btnLabel.TextXAlignment = Enum.TextXAlignment.Left
		btnLabel.Parent = TabBtn

		-- Page
		local Page = Instance.new("Frame")
		Page.Name = name .. "_Page"
		Page.Size = UDim2.new(1, 0, 1, 0)
		Page.Position = UDim2.new(0, 0, 0, 0)
		Page.BackgroundColor3 = Color3.fromRGB(20, 20, 25)
		Page.BorderSizePixel = 0
		Page.Parent = Pages
		Page.Visible = false
		Instance.new("UICorner", Page).CornerRadius = UDim.new(0, 12)
		ApplyNeonStroke(Page, 1.5)

		local PagePadding = Instance.new("UIPadding")
		PagePadding.PaddingTop = UDim.new(0, 12)
		PagePadding.PaddingLeft = UDim.new(0, 12)
		PagePadding.PaddingRight = UDim.new(0, 12)
		PagePadding.PaddingBottom = UDim.new(0, 12)
		PagePadding.Parent = Page

		local PageList = Instance.new("Frame")
		PageList.Size = UDim2.new(1, 0, 1, 0)
		PageList.BackgroundTransparency = 1
		PageList.Parent = Page

		local Layout = Instance.new("UIListLayout")
		Layout.Parent = PageList
		Layout.SortOrder = Enum.SortOrder.LayoutOrder
		Layout.Padding = UDim.new(0, 10)

		-- Element creation helpers for this page
		local function createElementContainer()
			local container = Instance.new("Frame")
			container.Size = UDim2.new(1, 0, 0, 48)
			container.BackgroundColor3 = Color3.fromRGB(25, 25, 30)
			container.BorderSizePixel = 0
			container.Parent = PageList
			Instance.new("UICorner", container).CornerRadius = UDim.new(0, 8)
			ApplyNeonStroke(container, 2)
			return container
		end

		-- Add a Button element
		local function AddButton(text, callback)
			local container = createElementContainer()
			local btn = Instance.new("TextButton")
			btn.Size = UDim2.new(1, -12, 1, -12)
			btn.Position = UDim2.fromOffset(6, 6)
			btn.BackgroundColor3 = Color3.fromRGB(35, 35, 40)
			btn.BorderSizePixel = 0
			btn.Text = text or "Button"
			btn.Font = Enum.Font.GothamBold
			btn.TextSize = 14
			btn.TextColor3 = Color3.fromRGB(230, 230, 230)
			btn.Parent = container
			Instance.new("UICorner", btn).CornerRadius = UDim.new(0, 6)
			local stroke = ApplyNeonStroke(btn, 2)

			btn.MouseButton1Click:Connect(function()
				-- flash tween
				pcall(function()
					local t1 = TweenService:Create(stroke, TweenInfo.new(0.12, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {Color = Color3.fromRGB(180,255,255)})
					local t2 = TweenService:Create(stroke, TweenInfo.new(0.36, Enum.EasingStyle.Quad, Enum.EasingDirection.In), {Color = Color3.fromRGB(0,160,255)})
					t1:Play()
					t1.Completed:Wait()
					t2:Play()
				end)
				if typeof(callback) == "function" then
					pcall(callback)
				end
			end)
			return btn
		end

		-- Add a Toggle element
		local function AddToggle(text, default, callback)
			default = default and true or false
			local container = createElementContainer()
			container.Size = UDim2.new(1, 0, 0, 52)

			local lbl = Instance.new("TextLabel")
			lbl.Size = UDim2.new(0.7, 0, 1, 0)
			lbl.BackgroundTransparency = 1
			lbl.Text = text or "Toggle"
			lbl.TextColor3 = Color3.fromRGB(230, 230, 230)
			lbl.Font = Enum.Font.GothamBold
			lbl.TextSize = 14
			lbl.TextXAlignment = Enum.TextXAlignment.Left
			lbl.Parent = container

			local toggleFrame = Instance.new("Frame")
			toggleFrame.Size = UDim2.new(0, 60, 0, 28)
			toggleFrame.Position = UDim2.new(1, -70, 0.5, -14)
			toggleFrame.BackgroundColor3 = Color3.fromRGB(35,35,40)
			toggleFrame.Parent = container
			toggleFrame.BorderSizePixel = 0
			Instance.new("UICorner", toggleFrame).CornerRadius = UDim.new(0, 14)
			ApplyNeonStroke(toggleFrame, 2)

			local knob = Instance.new("Frame")
			knob.Size = UDim2.new(0, 24, 0, 24)
			knob.Position = UDim2.new(default and 1 or 0, - (default and 28 or 2), 0.5, -12)
			knob.BackgroundColor3 = default and Color3.fromRGB(0, 200, 255) or Color3.fromRGB(65,65,70)
			knob.Parent = toggleFrame
			knob.BorderSizePixel = 0
			local knobCorner = Instance.new("UICorner", knob)
			knobCorner.CornerRadius = UDim.new(1, 0)
			ApplyNeonStroke(knob, 1.6)

			local state = default

			local function setState(s, noCallback)
				state = s
				if state then
					TweenService:Create(knob, TweenInfo.new(0.18, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {Position = UDim2.new(1, -28, 0.5, -12), BackgroundColor3 = Color3.fromRGB(0,200,255)}):Play()
				else
					TweenService:Create(knob, TweenInfo.new(0.18, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {Position = UDim2.new(0, 2, 0.5, -12), BackgroundColor3 = Color3.fromRGB(65,65,70)}):Play()
				end
				if typeof(callback) == "function" and not noCallback then
					pcall(callback, state)
				end
			end

			toggleFrame.InputBegan:Connect(function(input)
				if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
					setState(not state)
				end
			end)

			-- initialize
			setState(state, true)
			return toggleFrame, function() return state end
		end

		-- Add Dropdown element
		local function AddDropdown(text, options, callback)
			options = options or {}
			local container = createElementContainer()
			container.Size = UDim2.new(1, 0, 0, 44)

			local lbl = Instance.new("TextLabel")
			lbl.Size = UDim2.new(0.45, 0, 1, 0)
			lbl.BackgroundTransparency = 1
			lbl.Text = text or "Dropdown"
			lbl.TextColor3 = Color3.fromRGB(230, 230, 230)
			lbl.Font = Enum.Font.GothamBold
			lbl.TextSize = 14
			lbl.TextXAlignment = Enum.TextXAlignment.Left
			lbl.Parent = container

			local selection = Instance.new("TextButton")
			selection.Size = UDim2.new(0.5, -8, 1, 0)
			selection.Position = UDim2.new(0.5, 0, 0, 0)
			selection.BackgroundColor3 = Color3.fromRGB(30,30,35)
			selection.Text = "Select..."
			selection.Font = Enum.Font.Gotham
			selection.TextSize = 14
			selection.TextColor3 = Color3.fromRGB(200,200,200)
			selection.Parent = container
			Instance.new("UICorner", selection).CornerRadius = UDim.new(0, 8)
			local selStroke = ApplyNeonStroke(selection, 1.8)

			local listFrame = Instance.new("Frame")
			listFrame.Size = UDim2.new(1, 0, 0, 0)
			listFrame.Position = UDim2.new(0, 0, 1, 6)
			listFrame.ClipsDescendants = true
			listFrame.BackgroundTransparency = 1
			listFrame.Parent = container

			local open = false

			local function rebuildOptions()
				for _, v in pairs(listFrame:GetChildren()) do
					if not v:IsA("UIListLayout") and not v:IsA("UIPadding") then v:Destroy() end
				end
				local optsFrame = Instance.new("Frame")
				optsFrame.Size = UDim2.new(1, 0, 0, #options * 36)
				optsFrame.BackgroundTransparency = 1
				optsFrame.Parent = listFrame

				local optsLayout = Instance.new("UIListLayout")
				optsLayout.SortOrder = Enum.SortOrder.LayoutOrder
				optsLayout.Padding = UDim.new(0, 6)
				optsLayout.Parent = optsFrame

				for i, opt in ipairs(options) do
					local optBtn = Instance.new("TextButton")
					optBtn.Size = UDim2.new(1, 0, 0, 36)
					optBtn.BackgroundColor3 = Color3.fromRGB(32,32,36)
					optBtn.Text = tostring(opt)
					optBtn.TextColor3 = Color3.fromRGB(220,220,220)
					optBtn.Font = Enum.Font.Gotham
					optBtn.TextSize = 14
					optBtn.Parent = optsFrame
					optBtn.BorderSizePixel = 0
					Instance.new("UICorner", optBtn).CornerRadius = UDim.new(0, 6)
					ApplyNeonStroke(optBtn, 1.6)

					optBtn.MouseButton1Click:Connect(function()
						selection.Text = tostring(opt)
						open = false
						TweenService:Create(listFrame, TweenInfo.new(0.18, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {Size = UDim2.new(1, 0, 0, 0)}):Play()
						if typeof(callback) == "function" then pcall(callback, opt) end
					end)
				end
			end

			selection.MouseButton1Click:Connect(function()
				open = not open
				if open then
					rebuildOptions()
					local targetSize = UDim2.new(1, 0, 0, #options * 42)
					TweenService:Create(listFrame, TweenInfo.new(0.18, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {Size = targetSize}):Play()
				else
					TweenService:Create(listFrame, TweenInfo.new(0.12, Enum.EasingStyle.Quad, Enum.EasingDirection.In), {Size = UDim2.new(1, 0, 0, 0)}):Play()
				end
			end)

			return selection
		end

		-- Add Slider element
		local function AddSlider(text, min, max, default, step, callback)
			min = min or 0
			max = max or 100
			default = default or min
			step = step or 1

			local container = createElementContainer()
			container.Size = UDim2.new(1, 0, 0, 56)

			local lbl = Instance.new("TextLabel")
			lbl.Size = UDim2.new(0.5, 0, 0, 20)
			lbl.BackgroundTransparency = 1
			lbl.Text = text or "Slider"
			lbl.TextColor3 = Color3.fromRGB(230,230,230)
			lbl.Font = Enum.Font.GothamBold
			lbl.TextSize = 14
			lbl.TextXAlignment = Enum.TextXAlignment.Left
			lbl.Parent = container

			local valLabel = Instance.new("TextLabel")
			valLabel.Size = UDim2.new(0.5, -12, 0, 20)
			valLabel.Position = UDim2.new(0.5, 0, 0, 0)
			valLabel.BackgroundTransparency = 1
			valLabel.Text = tostring(default)
			valLabel.TextColor3 = Color3.fromRGB(200,200,200)
			valLabel.Font = Enum.Font.Gotham
			valLabel.TextSize = 14
			valLabel.TextXAlignment = Enum.TextXAlignment.Right
			valLabel.Parent = container

			local track = Instance.new("Frame")
			track.Size = UDim2.new(1, -12, 0, 12)
			track.Position = UDim2.new(0, 6, 0, 28)
			track.BackgroundColor3 = Color3.fromRGB(35,35,40)
			track.BorderSizePixel = 0
			track.Parent = container
			Instance.new("UICorner", track).CornerRadius = UDim.new(0, 6)
			ApplyNeonStroke(track, 1.6)

			local fill = Instance.new("Frame")
			fill.Size = UDim2.new( (default - min) / (max - min), 0, 1, 0)
			fill.BackgroundColor3 = Color3.fromRGB(0,200,255)
			fill.BorderSizePixel = 0
			fill.Parent = track
			Instance.new("UICorner", fill).CornerRadius = UDim.new(0, 6)
			ApplyNeonStroke(fill, 1.6)

			local thumb = Instance.new("Frame")
			thumb.Size = UDim2.new(0, 18, 0, 18)
			thumb.Position = UDim2.new(fill.Size.X.Scale, -9, 0.5, -9)
			thumb.BackgroundColor3 = Color3.fromRGB(0,200,255)
			thumb.BorderSizePixel = 0
			thumb.Parent = track
			Instance.new("UICorner", thumb).CornerRadius = UDim.new(1, 0)
			ApplyNeonStroke(thumb, 1.6)

			local dragging = false
			local function setFromPosition(x)
				local absolute = track.AbsoluteSize.X
				local relative = math.clamp(x - track.AbsolutePosition.X, 0, absolute)
				local fraction = relative / absolute
				local raw = min + (max - min) * fraction
				-- snap to step
				local stepped = math.floor((raw - min) / step + 0.5) * step + min
				stepped = math.clamp(stepped, min, max)
				local frac = (stepped - min) / (max - min)
				fill.Size = UDim2.new(frac, 0, 1, 0)
				thumb.Position = UDim2.new(frac, -9, 0.5, -9)
				valLabel.Text = tostring(stepped)
				if typeof(callback) == "function" then pcall(callback, stepped) end
			end

			track.InputBegan:Connect(function(input)
				if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
					dragging = true
					setFromPosition(input.Position.X)
				end
			end)

			track.InputChanged:Connect(function(input)
				if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
					if dragging then setFromPosition(input.Position.X) end
				end
			end)

			UIS.InputEnded:Connect(function(input)
				if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
					dragging = false
				end
			end)

			-- initialize
			setFromPosition((default - min) / (max - min) * track.AbsoluteSize.X + track.AbsolutePosition.X)

			return track
		end

		-- Add Textbox element
		local function AddTextbox(placeholder, callback)
			local container = createElementContainer()
			container.Size = UDim2.new(1, 0, 0, 48)

			local box = Instance.new("TextBox")
			box.Size = UDim2.new(1, -12, 1, -12)
			box.Position = UDim2.fromOffset(6, 6)
			box.BackgroundColor3 = Color3.fromRGB(30,30,35)
			box.Text = ""
			box.PlaceholderText = placeholder or "Enter text..."
			box.ClearTextOnFocus = false
			box.TextColor3 = Color3.fromRGB(230,230,230)
			box.Font = Enum.Font.Gotham
			box.TextSize = 14
			box.Parent = container
			Instance.new("UICorner", box).CornerRadius = UDim.new(0, 6)
			ApplyNeonStroke(box, 1.8)

			box.FocusLost:Connect(function(enterPressed)
				if enterPressed and typeof(callback) == "function" then
					pcall(callback, box.Text)
				end
			end)
			return box
		end

		-- expose API for this tab
		local tabAPI = {
			Page = Page,
			Button = AddButton,
			Toggle = AddToggle,
			Dropdown = AddDropdown,
			Slider = AddSlider,
			Textbox = AddTextbox,
			_Container = PageList,
			_Button = TabBtn
		}

		-- Button click switches page
		TabBtn.MouseButton1Click:Connect(function()
			hideAllPages()
			Page.Visible = true
			currentPage = Page
			-- disable the active state on this button while active (visual)
			TabBtn.Active = false
		end)

		table.insert(pageTable, tabAPI)

		-- if this is the first tab created, show it by default
		if #pageTable == 1 then
			hideAllPages()
			Page.Visible = true
			currentPage = Page
			TabBtn.Active = false
		end

		return tabAPI
	end

	-- create default tab
	local defaultTab = CreateTab("Main", MainIcon)

	--// MINI BUTTON (60x60 Square ImageButton)
	local MiniButton = Instance.new("ImageButton")
	MiniButton.Name = "MiniButton"
	MiniButton.Size = MiniButtonSize -- enforced exact 60x60
	-- Default position (can be dragged by user)
	MiniButton.Position = UDim2.fromScale(0.1, 0.1)
	MiniButton.BackgroundColor3 = Color3.fromRGB(20, 20, 25) -- solid background
	MiniButton.BorderSizePixel = 0
	MiniButton.Visible = false
	MiniButton.Parent = ScreenGui -- parent directly to ScreenGui to remain visible when Window hidden
	MiniButton.ZIndex = 999 -- ensure never hidden behind other UI
	MiniButton.ScaleType = Enum.ScaleType.Slice
	MiniButton.SliceCenter = Rect.new(4,4,60,60)

	local miniUICorner = Instance.new("UICorner")
	miniUICorner.CornerRadius = UDim.new(0, 12)
	miniUICorner.Parent = MiniButton

	-- Padding so the icon can be large but not cover the neon outline
	local miniPadding = Instance.new("UIPadding")
	miniPadding.PaddingTop = UDim.new(0, 4)
	miniPadding.PaddingBottom = UDim.new(0, 4)
	miniPadding.PaddingLeft = UDim.new(0, 4)
	miniPadding.PaddingRight = UDim.new(0, 4)
	miniPadding.Parent = MiniButton

	local MiniIcon = Instance.new("ImageLabel")
	-- Fill the padded area and center the icon
	MiniIcon.Size = UDim2.fromScale(1, 1)
	MiniIcon.Position = UDim2.fromScale(0.5, 0.5)
	MiniIcon.AnchorPoint = Vector2.new(0.5, 0.5)
	MiniIcon.BackgroundTransparency = 1
	MiniIcon.Image = OpenIcon
	MiniIcon.Parent = MiniButton
	MiniIcon.ZIndex = 1000

	local MiniStroke = Instance.new("UIStroke")
	MiniStroke.Color = Color3.fromRGB(0, 160, 255)
	MiniStroke.Thickness = 2.5 -- neon thickness
	-- ensure the glow stays on the outside edge
	MiniStroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
	MiniStroke.Parent = MiniButton
	MiniStroke.LineJoinMode = Enum.LineJoinMode.Bevel

	spawn(function()
		while MiniButton.Parent do
			local t = TweenService:Create(MiniStroke, TweenInfo.new(1.5, Enum.EasingStyle.Sine, Enum.EasingDirection.InOut, -1, true), {Color = Color3.fromRGB(0, 255, 255)})
			t:Play()
			break
		end
	end)

	-- Make both TopBar and MiniButton draggable (MiniButton draggable by itself)
	MakeDraggable(TopBar, Window)
	MakeDraggable(MiniButton, MiniButton)

	-- Minimize behavior: hide Window, show 60x60 ImageButton (parented to ScreenGui)
	Minimize.MouseButton1Click:Connect(function()
		Window.Visible = false
		-- show the standalone 60x60 ImageButton (ensure exact size)
		MiniButton.Visible = true
		MiniButton.Size = UDim2.fromOffset(0, 0)
		-- fixed: use EasingStyle.Back and EasingDirection.Out instead of non-existent BackOut
		TweenService:Create(MiniButton, TweenInfo.new(0.3, Enum.EasingStyle.Back, Enum.EasingDirection.Out), {Size = MiniButtonSize}):Play()
	end)

	-- Clicking the 60x60 ImageButton restores the window
	MiniButton.MouseButton1Click:Connect(function()
		MiniButton.Visible = false
		Window.Visible = true
		-- animate window open from 0 size to the main size
		Window.Size = UDim2.fromOffset(0, 0)
		-- fixed: use EasingStyle.Back and EasingDirection.Out instead of non-existent BackOut
		TweenService:Create(Window, TweenInfo.new(0.3, Enum.EasingStyle.Back, Enum.EasingDirection.Out), {Size = UDim2.fromOffset(650, 420)}):Play()
	end)

	-- Close Logic with confirmation overlay
	local function ShowCloseConfirm()
		Minimize.Active = false
		Close.Active = false
		local Overlay = Instance.new("Frame")
		Overlay.Size = UDim2.new(1, 0, 1, 0)
		Overlay.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
		Overlay.BackgroundTransparency = 0.6
		Overlay.ZIndex = 20
		Overlay.Parent = Window

		local ConfirmWindow = Instance.new("Frame")
		ConfirmWindow.Size = UDim2.fromOffset(350, 150)
		ConfirmWindow.AnchorPoint = Vector2.new(0.5, 0.5)
		ConfirmWindow.Position = UDim2.fromScale(0.5, 0.5)
		ConfirmWindow.BackgroundColor3 = Color3.fromRGB(25, 25, 30)
		ConfirmWindow.ZIndex = 21
		ConfirmWindow.Parent = Overlay
		Instance.new("UICorner", ConfirmWindow).CornerRadius = UDim.new(0, 12)
		ApplyNeonStroke(ConfirmWindow, 1.8)

		local ConfirmText = Instance.new("TextLabel")
		ConfirmText.Size = UDim2.new(1, -32, 0, 48)
		ConfirmText.Position = UDim2.fromOffset(16, 20)
		ConfirmText.BackgroundTransparency = 1
		ConfirmText.Text = "Are you sure you want to close the UI?"
		ConfirmText.TextColor3 = Color3.fromRGB(230, 230, 230)
		ConfirmText.Font = Enum.Font.GothamBold
		ConfirmText.TextSize = 18
		ConfirmText.TextWrapped = true
		ConfirmText.ZIndex = 22
		ConfirmText.Parent = ConfirmWindow

		local ButtonsFrame = Instance.new("Frame")
		ButtonsFrame.Size = UDim2.new(1, 0, 0, 40)
		ButtonsFrame.Position = UDim2.new(0, 0, 1, -20)
		ButtonsFrame.AnchorPoint = Vector2.new(0, 1)
		ButtonsFrame.BackgroundTransparency = 1
		ButtonsFrame.ZIndex = 22
		ButtonsFrame.Parent = ConfirmWindow

		local layout = Instance.new("UIListLayout")
		layout.Parent = ButtonsFrame
		layout.FillDirection = Enum.FillDirection.Horizontal
		layout.HorizontalAlignment = Enum.HorizontalAlignment.Center
		layout.Padding = UDim.new(0, 16)

		local ConfirmBtn = Instance.new("TextButton")
		ConfirmBtn.Size = UDim2.new(0, 120, 0, 36)
		ConfirmBtn.BackgroundColor3 = Color3.fromRGB(0, 170, 255)
		ConfirmBtn.Text = "Confirm"
		ConfirmBtn.TextColor3 = Color3.fromRGB(230, 230, 230)
		ConfirmBtn.Font = Enum.Font.GothamBold
		ConfirmBtn.TextSize = 16
		ConfirmBtn.ZIndex = 23
		ConfirmBtn.Parent = ButtonsFrame
		Instance.new("UICorner", ConfirmBtn).CornerRadius = UDim.new(0, 8)
		ApplyNeonStroke(ConfirmBtn, 2)

		local CancelBtn = Instance.new("TextButton")
		CancelBtn.Size = UDim2.new(0, 120, 0, 36)
		CancelBtn.BackgroundColor3 = Color3.fromRGB(45, 45, 50)
		CancelBtn.Text = "Cancel"
		CancelBtn.TextColor3 = Color3.fromRGB(220, 220, 220)
		CancelBtn.Font = Enum.Font.GothamBold
		CancelBtn.TextSize = 16
		CancelBtn.ZIndex = 23
		CancelBtn.Parent = ButtonsFrame
		Instance.new("UICorner", CancelBtn).CornerRadius = UDim.new(0, 8)
		ApplyNeonStroke(CancelBtn, 1.6)

		ConfirmBtn.MouseButton1Click:Connect(function()
			ScreenGui:Destroy()
		end)
		CancelBtn.MouseButton1Click:Connect(function()
			Overlay:Destroy()
			Minimize.Active = true
			Close.Active = true
		end)
	end
	Close.MouseButton1Click:Connect(ShowCloseConfirm)

	if typeof(Callback) == "function" then
		pcall(Callback)
	end

	-- Return main UI handles (including tab creator & the standalone MiniButton)
	return {
		Window = Window,
		Content = Content,
		Icon = Icon,
		MiniButton = MiniButton,
		CreateTab = CreateTab,
		DefaultTab = defaultTab
	}
end

return KazeUI
